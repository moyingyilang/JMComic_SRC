"use strict";(self.webpackChunk_18comic_react=self.webpackChunk_18comic_react||[]).push([[100],{7100:(e,t,s)=>{s.r(t),s.d(t,{default:()=>U});var a=s(9379),i=s(5043),n=s(6580),o=s(4117),r=s(4694),l=s(3546),c=s(4975),d=s(3944),m=s(6148),u=s(3817),g=s(7421),h=s(3438),p=s(1060),f=s(8028),x=s(501),v=s(2754),y=s(9459),w=s(4175),j=s(8390),S=s(2782),k=s(3752),b=s(1100),A=s(7680),N=s(5244),_=s(3344),I=s(7353),C=s(9070),L=s(7947),E=s(579);const D=e=>{const{readId:t,logined:s,isLoading:n,setIsVertical:l,isVertical:c,changeCurrentPage:d,scrollProgress:u,imageCount:g,handleSliderChange:h,handlePageChange:p,setDialogOpen:f,dialogOpen:D,readList:O,detailList:T,showSnackbar:z,closeNav:M}=e,{t:P}=(0,o.Bd)(),q=(0,m.j)(),{favoriteList:H}=(0,m.G)((e=>e.member)),[F,J]=(0,i.useState)(L.x),K=JSON.parse(localStorage.getItem("likedItems")||"[]"),[R,V]=(0,i.useState)((()=>{const e=localStorage.getItem("likedItems");return{like:e?JSON.parse(e):[],mark:[]}})),G=async(e,t)=>{if("like"===e){if(K.includes(t))return void z(P("snack.already_rated"),"success");localStorage.setItem("likedItems",JSON.stringify([...K,t]));const e=await q((0,b.c1)({id:t})).unwrap(),{code:s,msg:a,status:i}=e.data;if(200===s){z(a,"success"!==i?"error":"success")}}if("mark"===e)if(s){(()=>{q((0,A.a9)("favoriteList"));const{folder_id:e,o:t}=F;q((0,b.an)({page:1,folder_id:e,o:t}))})(),((e,t)=>{V((s=>{const i=s[e]||[],n=i.includes(t)?i.filter((e=>e!==t)):[...i,t];return(0,a.A)((0,a.A)({},s),{},{[e]:n})}))})("mark",t),J((0,a.A)((0,a.A)({},F),{},{aid:t}));const e=await q((0,b.df)(t)).unwrap(),{code:s,data:i}=e;if(200===s){const e="ok"!==i.status?"error":"success";z(i.msg,e)}"ok"===i.status&&"add"===i.type&&f((0,a.A)((0,a.A)({},D),{},{folder:!0}))}else z(P("login.please_login"),"error"),f((0,a.A)((0,a.A)({},D),{},{login:!0}))};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(r.P.nav,{initial:{y:0},animate:{y:M?100:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed left-0 bottom-0 w-full bg-nbk bg-opacity-90 z-20",children:[(0,E.jsxs)("div",{className:"flex justify-around items-center",children:[(0,E.jsx)(v.A,{className:"".concat(d.prev?"":"opacity-0"),onClick:()=>p("prev")}),(0,E.jsx)("span",{children:u<1?1:u}),(0,E.jsx)(I.A,{sx:{width:250},children:(0,E.jsx)(C.Ay,{value:u,min:1,valueLabelFormat:e=>"".concat(e),max:g,valueLabelDisplay:"auto",onChange:h,sx:{"& .MuiSlider-thumb":{backgroundColor:"#ff6f00"},"& .MuiSlider-rail":{backgroundColor:"#bbb",opacity:"1"},"& .MuiSlider-track":{backgroundColor:"#ff6f00",border:"none"}}})}),(0,E.jsx)("span",{children:g}),(0,E.jsx)("div",{children:(0,E.jsx)(x.A,{className:"".concat(d.next?"":"opacity-0"),onClick:()=>p("next")})})]}),(0,E.jsxs)("div",{className:"flex justify-around items-center text-center pt-2 pb-4",children:[(0,E.jsxs)("div",{className:"".concat(n?"text-[#aaa]":""),onClick:()=>!n&&l(!c),children:[(0,E.jsx)(y.A,{className:"text-2xl"}),(0,E.jsx)("p",{children:P(c?"detail.read_horizontally":"detail.read_vertically")})]}),(0,E.jsxs)("div",{onClick:()=>f((0,a.A)((0,a.A)({},D),{},{series:!0})),children:[(0,E.jsx)(w.A,{className:"text-2xl"}),(0,E.jsx)("p",{children:P("detail.chapter")})]}),(0,E.jsxs)("div",{onClick:()=>f((0,a.A)((0,a.A)({},D),{},{comment:!0})),children:[(0,E.jsx)(j.A,{className:"text-2xl"}),(0,E.jsx)("p",{children:P("detail.comments")})]}),(0,E.jsxs)("div",{onClick:()=>G("mark",t),children:[O.is_favorite?(0,E.jsx)(k.A,{className:"text-og"}):(0,E.jsx)(S.A,{className:"text-2xl text-white"}),(0,E.jsx)("p",{children:P("detail.favorites")})]}),(0,E.jsxs)("div",{onClick:()=>G("like",t),children:[(0,E.jsx)(N.A,{className:"text-2xl ".concat(O.liked||K.includes(t)?"text-og":"")}),(0,E.jsx)("p",{children:P("detail.like")})]})]})]}),D.folder&&(0,E.jsx)(_.A,{folderList:H.folder_list,dialogOpen:D,setDialogOpen:f,editFolder:F,setEditFolder:J,handleEditFolder:async e=>{"del"===e&&f((0,a.A)((0,a.A)({},D),{},{alert:!0}));const{folder_id:t,folder_name:s,aid:i}=F;if(""!==t){const a=(await q((0,b.Je)({type:e,folder_id:t,folder_name:s,aid:i}))).payload,{msg:n,status:o}=a.data;"ok"===o&&z(n,"ok"!==o?"error":"success")}else z(P("comic.added_to_favorites_success"),"success");J((e=>(0,a.A)((0,a.A)({},e),L.x)))},tagsList:T.tags})]})};var O=s(30),T=s(6733),z=s(7044),M=s(7738),P=s(5411),q=s(1299),H=s(5331),F=s(2325),J=s(223),K=s(9011),R=s(5412),V=s(8038),G=s(5403);const U=()=>{var e,t,s;const x=(0,n.Zp)(),{config:v,setConfig:y}=(0,d.H)(),{setting:w,logined:j}=v,{t:S}=(0,o.Bd)(),{snackbars:k,setSnackbars:A,showSnackbar:N}=(0,q.q)(),_=S("detail.read_rules",{returnObjects:!0}),[I,C]=(0,i.useState)({readSource:!1,login:!1,signUp:!1,forgot:!1,newTopic:!1,folder:!1,series:!1,comment:!1}),[U,W]=(0,i.useState)(!0),[B,Z]=(0,i.useState)(L.Z),Q=(0,m.j)(),{detailList:X,readList:Y,isLoading:$}=(0,m.G)((e=>e.detail)),ee=(0,n.zy)(),te=new URLSearchParams(ee.search),se=te.get("id"),ae=te.get("readId"),ie=te.get("episode"),ne=te.get("subEpisode"),[oe,re]=(0,i.useState)([]),[le,ce]=(0,i.useState)(!1),[de,me]=(0,i.useState)(!1),[ue,ge]=(0,i.useState)({detail:!1,detailDownload:!1,readTrack:!1}),[he,pe]=(0,i.useState)({prev:!0,next:!0}),[fe,xe]=(0,i.useState)({menus:[],episode:Number(ie),subEpisode:ne,currentChapterId:ae}),[ve,ye]=(0,i.useState)((()=>{const e=localStorage.getItem("read");return e?JSON.parse(e):[]})),we=(null===(e=Y.images)||void 0===e?void 0:e.length)+3||1,je=(0,i.useRef)([]),[Se,ke]=(0,i.useState)(1),be=(0,i.useRef)(null),Ae=(0,i.useRef)(null);(0,i.useEffect)((()=>{sessionStorage.removeItem("searchQuery");if(G.Ii.isNativePlatform()){if(!localStorage.getItem("hasShownVolumeHint")){const e=setTimeout((()=>{N("\u53ef\u4f7f\u7528\u97f3\u91cf\u9375\uff0b\u7ffb\u9801","success"),localStorage.setItem("hasShownVolumeHint","true")}),1e3);return()=>clearTimeout(e)}}}),[]),(0,i.useEffect)((()=>{var e;ke(1),window.scrollTo({top:0,behavior:"smooth"}),Q((0,F.Fx)("readList")),Q((0,J.Mj)()),ae&&se&&(Q((0,H.LN)(ae)),Q((0,H.Gh)(se))),null!==(e=Ae.current)&&void 0!==e&&e.swiper&&!U&&Ae.current.swiper.slideTo(0,0)}),[ae,se,U,v.app_img_shunt]);(0,i.useEffect)((()=>{var e,t;(null===(e=Y.images)||void 0===e?void 0:e.length)>0&&(null===(t=je.current)||void 0===t?void 0:t.length)>0&&(async()=>{Q((0,F.g6)({isLoading:!0}));const e=je.current,t=[Se-2,Se-1,Se,Se+1,Se+2];try{for(const s of t){const t=e[s];if(!t)continue;if(!(t.nextElementSibling instanceof HTMLCanvasElement)){await new Promise((e=>{t.complete?e():t.onload=()=>e()})),await(0,R.wR)(t,Y.id,Y.scramble_id,t.alt);const e=t.nextElementSibling;e instanceof HTMLCanvasElement&&(e.style.position="absolute",e.style.top="0",e.addEventListener("click",(()=>{me((e=>!e))})),e.addEventListener("contextmenu",(e=>{e.preventDefault()}))),null!==e&&0!==t.src.indexOf(".gif")||(t.classList.remove("opacity-0"),t.style.opacity="1",t.dataset.noScrambleMark="noScramble",t.addEventListener("click",(()=>{me((e=>!e))}))),Q((0,F.g6)({isLoading:!1}))}}}finally{Q((0,F.g6)({isLoading:!1}))}})()}),[Y,Se]),(0,i.useEffect)((()=>{if(U&&!$){let e=0,t=0,s=0;const i=()=>{const i=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,{images:o,total_page:r}=Y,l=Math.ceil(i/n*we);var c;if(null!==o&&void 0!==o&&o.length&&(ke(l),(null===(c=X.series)||void 0===c?void 0:c.length)>0)){const e=r-3,t=X.series[X.series.length-1],s=localStorage.getItem("dontShowExpiry");l===e&&ne===t.sort&&ge((0,a.A)((0,a.A)({},ue),{},{readTrack:null===s}))}const d=i-e;if(d>0){if(t+=d,s=0,t>=2e3){const e=document.querySelectorAll("canvas");e.length>0&&e[0].remove(),t=0}}else if(d<0&&(s+=Math.abs(d),t=0,s>=2e3)){const e=document.querySelectorAll("canvas");e.length>0&&e[e.length-1].remove(),s=0}e=i};return window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)}}}),[Y,X,U]);const Ne=e=>{const t=Math.max(we,1),{scrollHeight:s,clientHeight:a}=document.documentElement,i=s-600-a;if(i<=0)return;const n=e/t;window.scrollTo({top:n*i,behavior:"smooth"})};(0,i.useEffect)((()=>{if($)return;let e=0;function t(t){const s=Date.now();if(s-e<150)return;e=s;const{direction:a}=t.detail||{};ke((e=>{let t=e;var s,i;("up"===a?t=Math.max(0,e-1):"down"===a&&(t=Math.min(we-1,e+1)),U)?Ne(t):null===(s=Ae.current)||void 0===s||null===(i=s.swiper)||void 0===i||i.slideTo(t-1);return t}))}return window.addEventListener("volumeKeyPressed",t),()=>window.removeEventListener("volumeKeyPressed",t)}),[we,U]),(0,i.useEffect)((()=>{ve.length>0&&localStorage.setItem("read",JSON.stringify(ve))}),[ve]);const _e=e=>{ye((t=>t.includes(e)?t:[...t,e]))};(0,i.useEffect)((()=>{const e=X.series;if(!e||0===e.length)return void pe({next:!1,prev:!1});const t=e.find((e=>e.id===ae));if(!t)return void pe({next:!1,prev:!1});const s=Number(t.sort),a=1===s,i=s===e.length;pe({next:!i,prev:!a})}),[ae,X.series]);(0,i.useEffect)((()=>{const{series:e}=X;if((null===e||void 0===e?void 0:e.length)>0){const t=[];for(let a=0;a<e.length;a+=10)t.push(e.slice(a,a+10));const s=t.reverse().findIndex((e=>e.some((e=>e.id===ae))));xe((0,a.A)((0,a.A)({},fe),{},{menus:t,episode:s}))}}),[X.series]);return(0,i.useEffect)((()=>{if(1===(null===w||void 0===w?void 0:w.is_cn)){const e=[{title:S("modal.fast_track"),key:0},...w.app_shunts||[]];re(e)}else re(w.app_shunts)}),[null===w||void 0===w?void 0:w.is_cn]),(0,E.jsxs)(E.Fragment,{children:[$&&(0,E.jsx)(P.A,{}),(0,E.jsxs)("div",{className:"min-h-screen bg-white text-white relative",children:[(0,E.jsxs)(r.P.div,{initial:{y:0},animate:{y:de?-64:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 w-full h-14 bg-nbk bg-opacity-90 flex justify-between items-center px-3 py-2 z-50",children:[(0,E.jsx)(K.ee,{back:"/comic/detail?id=".concat(se||X.series_id)}),(0,E.jsx)("p",{className:"truncate w-10/12",children:Y.name}),(0,E.jsx)(u.A,{sx:{fontSize:26,stroke:"white",strokeWidth:1},onClick:()=>ce(!0)})]}),(0,E.jsx)("div",{onClick:e=>e.preventDefault(),className:"pt-20 pb-40 flex items-center min-h-screen",ref:be,style:{flexDirection:U?"column":"row",overflowX:U?"hidden":"scroll",overflowY:U?"scroll":"hidden",scrollSnapType:U?"y mandatory":"x mandatory"},children:U?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(V.A,{adKey:"app_chapter_next"}),(null===(t=Y.images)||void 0===t?void 0:t.length)>0&&Y.images.map(((e,t)=>(0,E.jsx)("div",{className:"w-full relative",children:(0,E.jsx)("img",{ref:e=>je.current[t]=e,src:e.image,alt:e.image.match(/\/([^\/]+)\.webp/)[1],width:"100%",height:"auto",id:"img_"+e.page,className:"w-full object-cover",style:{opacity:0},loading:"lazy",draggable:!1,onContextMenu:e=>e.preventDefault(),onDragStart:e=>e.preventDefault()})},e.page))),(0,E.jsx)(V.A,{adKey:"app_thewayhome"}),(0,E.jsx)(V.A,{adKey:"app_chapter_last"})]}):(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)(c.RC,{initialSlide:0,className:"mySwiper h-screen",onSlideChange:e=>{const t=e.activeIndex+1;if(ke(t),Ae.current){const e=document.querySelectorAll("canvas");Ae.current.swiper.realIndex%5===0&&e.length>0&&e[0].remove()}},ref:Ae,children:[(0,E.jsx)(c.qr,{children:(0,E.jsx)(V.A,{adKey:"app_chapter_next"})}),(null===(s=Y.images)||void 0===s?void 0:s.length)>0&&Y.images.map(((e,t)=>(0,E.jsx)(c.qr,{children:(0,E.jsx)("img",{ref:e=>je.current[t]=e,src:e.image,alt:e.image.match(/\/([^\/]+)\.webp/)[1],width:"100%",height:"auto",loading:"lazy",id:"img_"+e.page,className:"w-full object-cover opacity-0",draggable:!1,onContextMenu:e=>e.preventDefault(),onDragStart:e=>e.preventDefault()})},e.image))),(0,E.jsx)(c.qr,{className:"w-100%",children:(0,E.jsx)(V.A,{adKey:"app_thewayhome"})}),(0,E.jsx)(c.qr,{children:(0,E.jsx)(V.A,{adKey:"app_chapter_last"})})]})})}),I.series&&(0,E.jsxs)("div",{className:"w-full h-[90vh] sticky bottom-0 left-0 bg-white dark:bg-bbk z-50 overflow-y-auto transition-all duration-1000 ".concat(I.series?"animate-move-up":"animate-move-down"),children:[(0,E.jsxs)("div",{className:"h-12 sticky top-0 bg-nbk flex items-center z-20",children:[(0,E.jsx)(h.A,{sx:{fontSize:24,stroke:"white",strokeWidth:2,marginLeft:2},onClick:()=>C((0,a.A)((0,a.A)({},I),{},{series:!1}))}),(0,E.jsx)("p",{className:"ml-5 truncate w-9/12",children:Y.name})]}),(0,E.jsx)("div",{className:"w-11/12 m-auto",children:(0,E.jsx)(p.A,{t:S,episodeOnTop:!0,queryId:se,detailList:X,seriesGroups:fe,setSeriesGroups:xe,msgOpen:ue,handlerReadStorage:_e,readHistory:ve,setDialogOpen:C})})]}),I.comment&&(0,E.jsxs)("div",{className:"w-full h-[90vh] sticky bottom-0 left-0 bg-[#ededed] z-30 overflow-y-auto transition-all duration-1000 ".concat(I.comment?"animate-move-up":"animate-move-down"),children:[(0,E.jsxs)("div",{className:"h-12 sticky top-0 bg-nbk flex items-center z-20",children:[(0,E.jsx)(h.A,{sx:{fontSize:24,stroke:"white",strokeWidth:2,marginLeft:2},onClick:()=>C((0,a.A)((0,a.A)({},I),{},{comment:!1}))}),(0,E.jsx)("p",{className:"ml-5 truncate w-9/12",children:Y.name})]}),(0,E.jsxs)("div",{className:"w-full m-auto text-gy dark:text-tgy dark:bg-bbk",children:[(0,E.jsx)("div",{className:"py-3 px-2",children:Array.isArray(_)&&_.map((e=>(0,E.jsx)("p",{children:e},e)))}),(0,E.jsx)(f.A,{t:S,setConfig:y,bottomTopicInput:!0,queryId:se,setting:w,logined:j,dialogOpen:I,setDialogOpen:C,showSnackbar:N})]})]}),(0,E.jsx)(l.N,{children:!de&&(0,E.jsx)(r.P.button,{className:"fixed left-4 bottom-40 bg-og rounded-full size-16 z-20",onClick:()=>C((0,a.A)((0,a.A)({},I),{},{readSource:!0})),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},whileTap:{scale:.9},whileHover:{scale:1.05},children:(0,E.jsx)(g.A,{className:"text-4xl"})})}),(0,E.jsx)(D,{readId:ae,logined:j,isLoading:$,setIsVertical:W,isVertical:U,changeCurrentPage:he,handlePageChange:e=>{pe((0,a.A)((0,a.A)({},he),{},{next:!0,prev:!0}));const{series:t}=X;if((null===t||void 0===t?void 0:t.length)>0){const s=t.findIndex((e=>e.id===ae)),i=t["next"===e?s+1:s-1];if(i){const e=fe.menus.findIndex((e=>e.some((e=>e.id===ae))));xe((e=>(0,a.A)((0,a.A)({},e),{},{subEpisode:i.sort,currentChapterId:i.id}))),_e(i.id),x("/comic/detail/read?id=".concat(se,"&readId=").concat(i.id,"&episode=").concat(e,"&subEpisode=").concat(i.sort))}}},scrollProgress:Se,imageCount:we,handleSliderChange:(e,t)=>{const s=t;U?Ne(s):Ae.current&&(Ae.current.swiper.slideTo(t-1),ke(s))},setDialogOpen:C,dialogOpen:I,readList:Y,detailList:X,showSnackbar:N,closeNav:de})]}),I.readSource&&(0,E.jsx)(z.A,{readImgSource:oe,setDialogOpen:C,dialogOpen:I}),le&&(0,E.jsx)(O.A,{share:le,setShare:ce,setting:w,queryId:ae,showSnackbar:N}),(I.login||I.signUp||I.forgot)&&!j&&(0,E.jsx)(M.A,{setFormData:Z,formData:B,setConfig:y,logined:j,isLoading:$,setDialogOpen:C,dialogOpen:I,showSnackbar:N}),ue.readTrack&&(0,E.jsx)(T.A,{t:S,logined:j,queryId:se,setMsgOpen:ge,msgOpen:ue,handleTracking:async e=>{if(j){const t=await Q((0,b.mI)(e)).unwrap(),{code:s,data:a}=t;200===s&&N(a,"success")}else N(S("login.please_login"),"error"),C((0,a.A)((0,a.A)({},I),{},{login:!0}))},handleSetDontShow:e=>{const t=localStorage.getItem("threeDaysDontShow"),s=t?JSON.parse(t):[];if(e.target.checked){if(!s.includes(se)){s.push(se),localStorage.setItem("threeDaysDontShow",JSON.stringify(s));const e=Date.now()+2592e5;localStorage.setItem("dontShowExpiry",e.toString())}}else{const e=s.filter((e=>e!==se));localStorage.setItem("threeDaysDontShow",JSON.stringify(e)),localStorage.removeItem("dontShowExpiry")}}}),(0,E.jsx)(q.A,{setSnackbars:A,snackbars:k})]})}}}]);
//# sourceMappingURL=100.58275ee7.chunk.js.map